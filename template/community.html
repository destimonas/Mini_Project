{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .header {
            background-color: #6f42c1; 
            color: #fff;
            padding: 10px;
            text-align: left;
        }
        .header-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        .header-options ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .header-options ul li {
            display: inline;
            margin-right: 10px;
        }
        .sidebar {
            position: fixed;
            top: 130px;
            left: 10%; /* Adjusted position */
            width: 200px;
            background-color: #cecece;
            padding: 10px;
            text-align: center;
        }
        .sidebar ul {
            list-style-type: none;
            padding: 0;
        }
        .sidebar ul li {
            margin-bottom: 10px;
        }
        .sidebar ul li a {
            color: #333;
            text-decoration: none;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
            z-index: 1;
        }
        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }
        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }
        .dropdown:hover .dropdown-content {
            display: block;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            padding-top: 60px;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 45%;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
       .cancel-btn, .post-btn {
            background-color: #6f42c1;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }

        .cancel-btn:hover, .post-btn:hover {
            background-color: #512da8;
        }

        .modal-content form {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-top: 20px;
        }

        .media-upload {
            display: flex;
            align-items: center;
        }

        .media-upload img {
            margin-right: 10px;
        }

        .media-upload span {
            font-size: 16px;
        }

        .button-group {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
        }
        .modal-content {
            width: 60%; /* Adjust width as needed */
        }
        
        #discussionTitle {
            width: 100%; /* Make title input full width */
            margin-bottom: 20px; /* Add some space below the title */
        }
        
        .media-upload {
            margin-bottom: 20px; /* Add space below the media upload section */
        }
        
        #discussionContent {
            width: 100%; /* Make textarea full width */
            resize: vertical; /* Allow vertical resizing */
            margin-bottom: 20px; /* Add space below the textarea */
        }
        
        .button-group {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
        }
        
        .cancel-btn,
        .post-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .cancel-btn:hover,
        .post-btn:hover {
            background-color: #512da8;
        }
        
        .modal-content form {
            display: flex;
            flex-direction: column;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        
        @media only screen and (max-width: 600px) {
            .modal-content {
                width: 90%; /* Adjust width for smaller screens */
            }
        }
        .messages .success {
            color: green;
        }
                /* CSS styles for the top horizontal sidebar */
        .top-sidebar {
        
            width: 40%; /* Adjust width as per your preference */
            margin: 0 auto; /* Center the sidebar horizontally */
            background-color: #cecece; /* Change the background color */
            text-align: center;
            padding: 15px 0; /* Add padding for better appearance */
        }

        .top-sidebar-options {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .top-sidebar-options li {
            display: inline-block;
            margin-right: 20px;
        }

        .top-sidebar-options li:last-child {
            margin-right: 0;
        }

        .top-sidebar-options li a {
            text-decoration: none;
            color: #333;
            padding: 10px 15px;
            display: inline-block;
            transition: background-color 0.3s;
        }

        .top-sidebar-options li a:hover {
            background-color: #ddd;
        }

        .button-group {
            margin-top: 20px;
            display: flex;
            justify-content: center;
        }

        .button-group button {
            background-color: #3498db;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px; /* Adjust margin as needed */
        }

        .button-group button:hover {
            background-color: #512da8;
        }
        /* Centering the discussion container */
        .discussion-container {
            text-align: center;
        }

        /* Styles for discussion content */
        .discussion {
            margin: 0 auto; /* Center the discussion */
            max-width: 600px; /* Adjust the max-width as per your design */
            padding: 20px;
            border: 1px solid #ccc;
            margin-bottom: 20px;
        }

        .discussion img {
            max-width: 100%; /* Ensure images don't exceed container width */
            height: auto;
            margin-top: 10px; /* Add some spacing between content and image */
        }

        /* CSS styles for the transformation container */
        .transformations-content {
            margin: 0 auto; /* Center the content horizontally */
            max-width: 800px; /* Adjust the maximum width as needed */
            padding: 20px;
        }

        .transformation {
            background-color: #f9f9f9; /* Background color for each transformation */
            border: 1px solid #ddd; /* Border around each transformation */
            border-radius: 5px; /* Rounded corners */
            padding: 15px; /* Padding around each transformation */
            margin-bottom: 20px; /* Spacing between transformations */
        }

        .transformation img {
            max-width: 100%; /* Ensure images don't exceed container width */
            height: auto; /* Maintain aspect ratio */
            margin-bottom: 10px; /* Spacing below the image */
        }

        .transformation p {
            margin-bottom: 10px; /* Spacing between paragraphs */
        }

        .transformation p:last-child {
            margin-bottom: 0; /* Remove bottom margin for the last paragraph */
        }
        /* CSS styles for the transformation container */
        #transformation-container {
            margin: 0 auto; /* Center the container horizontally */
            max-width: 800px; /* Adjust the maximum width as needed */
            padding: 20px;
        }

        .transformation {
            background-color: #f9f9f9; /* Background color for each transformation */
            border: 1px solid #ddd; /* Border around each transformation */
            border-radius: 5px; /* Rounded corners */
            padding: 15px; /* Padding around each transformation */
            margin-bottom: 20px; /* Spacing between transformations */
            text-align: center; /* Center content inside transformation */
        }

        .transformation img {
            max-width: 100%; /* Ensure images don't exceed container width */
            height: auto; /* Maintain aspect ratio */
            margin-bottom: 10px; /* Spacing below the image */
        }

        .transformation p {
            margin-bottom: 10px; /* Spacing between paragraphs */
        }

        .transformation p:last-child {
            margin-bottom: 0; /* Remove bottom margin for the last paragraph */
        }


        #recipe-container {
            width: 40%; /* Adjust the width as per your preference */
            margin: 0 auto; /* Center the container horizontally */
            padding: 20px; /* Add padding for spacing */
            background-color: #f2f2f2; /* Set background color */
            border-radius: 10px; /* Add rounded corners */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Add shadow for depth */
        }

        .recipe {
            margin-bottom: 20px; /* Add space between recipes */
            border-bottom: 1px solid #ddd; /* Add a bottom border between recipes */
            padding-bottom: 20px; /* Add padding between recipes */
        }

        .recipe img {
            max-width: 100%; /* Ensure images don't exceed container width */
            height: auto; /* Maintain aspect ratio */
            display: block; /* Center images horizontally */
            margin: 10px auto; /* Center images vertically */
            border-radius: 5px; /* Add rounded corners to images */
        }
        .actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .actions .action {
            margin: 0 55px; /* Adjust the margin to add spacing between action icons */
        }

        .actions .action img {
            width: 20px; /* Set the width of the action icons */
            height: auto; /* Maintain aspect ratio */
        }


        .action img {
            width: 20px; /* Adjust the width to your preference */
            height: 20px; /* Adjust the height to your preference */
            margin-right: 5px; /* Adjust the margin to your preference */
        }

        .comment-section {
            display: flex;
            align-items: center;
        }

        .comment-input {
            width: 70%;
            flex: 1;
            padding: 5px;
            margin-right: 10px;
        }

        .comment-button {
            padding: 5px 10px;
            background-color: #007bff;
            color: #fff;
            border: none;
            cursor: pointer;
        } 
     /* Share Modal Styles */
#share-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.4);
}

.modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%; /* Adjust as needed */
    max-width: 500px; /* Maximum width for the modal content */
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Add a shadow effect */
}

.btn-share {
    display: block;
    text-align: center;
    margin-bottom: 10px;
    font-size: 24px;
    color: #333;
    text-decoration: none;
    transition: color 0.3s ease;
}

.btn-share:hover {
    color: #000;
}


    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    {% if messages %}
    <ul class="messages">
        {% for message in messages %}
            <li class="{% if message.tags %}{{ message.tags }}{% endif %}">{{ message }}</li>
        {% endfor %}
    </ul>
{% endif %}



<div class="header">
    <div class="header-options">
        <h1>FitUp</h1>
        <ul>
            <li>Me</li>
            <li>Community</li>
            <li>Post</li>
            <li> <a href="{% url 'explore' %}" style="color: white;">Explore</a></li>
            <li>Group</li>
            <li></li>
            <li><a href="{% url 'userhome' %}" style="position: absolute; right: 20px; top: 38px; color: white;">Back</a></li>
        </ul>
    </div>
</div>

<div class="top-sidebar">
    <ul class="top-sidebar-options">
        <li><a href="#" onclick="showModal('discussion')">Discussion</a></li>
        <li><a href="#" onclick="showModal('fitnessUpdate')">Fitness Update</a></li>
        <li><a href="#" onclick="showModal('transformation')">Transformation</a></li>
        <li><a href="#" onclick="showModal('recipe')">Recipe</a></li>
       
    </ul>
</div> 

<div class="button-group" style="text-align: center;">
    <button id="btn-all" onclick="showAll()">All</button>
    <button id="btn-discussion" onclick="showDiscussions()">Discussion</button>
    <button id="btn-transformation" onclick="showTransformations()">Transformation</button>
    <button id="btn-recipe" onclick="showRecipes()">Recipe</button>
    <button id="btn-article">Article</button>
</div>

    <div class="sidebar">
        <!-- User Avatar and Name -->
        <img src="{% static 'images/avathar.jpg' %}" alt="User Avatar" width="50" height="50">
        <br>
        <ul>
            {% if user.is_authenticated %}
            <p>{{ user.username }}</p>
            {% endif %}
          
            <li><a href="#">Get a Coach</a></li>
            <li><a href="#">My Plan</a></li>
            <li><a href="product.html">Fitshop</a></li>
        </ul>
        <div class="dropdown">
            <a class="dropbtn">+Add Post</a>
           
            <div class="dropdown-content">
                <a href="#" onclick="showModal('discussion')" value="Discussion">Discussion</a>
                <a href="#" onclick="showModal('fitnessUpdate')" value="Fitness Update">Fitness Update</a>
                <a href="#" onclick="showModal('transformation')" value="Transformation">Transformation</a>
                <a href="#" onclick="showModal('recipe')" value="Recipe">Recipe</a>
            </div>
        </div>
    </div>


    <div class="container" id="discussion-container">
        <h3 style="text-align: center;">Discussions</h3>
        {% if discussions %}
            {% for discussion in discussions %}
                <div class="discussion" id="discussion-{{ discussion.id }}">
                    <h4>{{ discussion.title }}</h4>
                    {% if discussion.image %}
                        <img src="{{ discussion.image.url }}" alt="Discussion Image" style="max-width: 100%;">
                    {% endif %}
                    <p>{{ discussion.content }}</p>
                    <p>Posted by: {{ discussion.user.username }}</p>
    
                    <hr>
                    <div class="actions">
                        <div class="like-section">
                            <span class="action" onclick="toggleLike('{{ discussion.id }}')">
                                <img src="{% static 'images/like.jpg.jpg' %}" alt="Like" id="like-icon-{{ discussion.id }}" class="{% if request.user in discussion.likes.all %} liked {% endif %}">
                                <span id="like-count-{{ discussion.id }}">{{ discussion.like_count }}</span>
                            </span>
                        </div>
                        
                        <span class="action" onclick="toggleCommentSection('{{ discussion.id }}')"><img src="{% static 'images/comment.jpg.jpg' %}" alt="Comment"> Comment</span>
                        <span class="action" onclick="showShareModal('{{ discussion.id }}')"><img src="{% static 'images/share.jpg.jpg' %}" alt="Share"> Share</span>
                    </div>
                    <div id="comment-section-{{ discussion.id }}" class="comment-section" style="display: none;">
                        <input type="text" id="comment-input-{{ discussion.id }}" class="comment-input" placeholder="Write a comment">
                        <button onclick="postComment('{{ discussion.id }}')" class="comment-button">Post Comment</button>
                        <div id="comment-list-{{ discussion.id }}"></div>
                    </div>
                    <hr>
                    <script>
                        function postComment(discussionId) {
                            var commentInput = document.getElementById('comment-input-' + discussionId);
                            var content = commentInput.value.trim(); // Trim any leading/trailing whitespaces
                        
                            if (content !== '') {
                                // Send AJAX request to post comment
                                $.ajax({
                                    url: '/post-comment/' + discussionId + '/', // Your Django view URL
                                    method: 'POST',
                                    data: {
                                        'content': content,
                                        'csrfmiddlewaretoken': '{{ csrf_token }}' // Ensure CSRF token is included
                                    },
                                    success: function(response) {
                                        if (response.status === 'success') {
                                            // Clear the comment input field
                                            commentInput.value = '';
                                            // Refresh the comment section (if needed)
                                            // You can append the new comment to the comment list without reloading the page
                                            fetchComments(discussionId); // Fetch comments after posting a new comment
                                        } else {
                                            alert('Failed to post comment: ' + response.message);
                                        }
                                    },
                                    error: function(xhr, status, error) {
                                        console.error('Error posting comment:', error);
                                    }
                                });
                            } else {
                                alert('Please enter a non-empty comment.');
                            }
                        }
                        
                        // Function to fetch and display comments for a discussion
                        function fetchComments(discussionId) {
                            $.ajax({
                                url: '/fetch-comments/' + discussionId + '/',
                                method: 'GET',
                                success: function(response) {
                                    var commentList = document.getElementById('comment-list-' + discussionId);
                                    commentList.innerHTML = ''; // Clear previous comments
                                    response.forEach(function(comment) {
                                        var commentDiv = document.createElement('div');
                                        commentDiv.innerHTML = '<p><strong>' + comment.user + '</strong>: ' + comment.content + '</p>';
                                        commentList.appendChild(commentDiv);
                                    });
                                },
                                error: function(xhr, status, error) {
                                    console.error('Error fetching comments:', error);
                                }
                            });
                        }

                        // Toggle comment section visibility and fetch comments
                        function toggleCommentSection(discussionId) {
                            var commentSection = document.getElementById('comment-section-' + discussionId);
                            if (commentSection.style.display === 'none') {
                                commentSection.style.display = 'block';
                                fetchComments(discussionId); // Fetch comments when the comment section is toggled
                            } else {
                                commentSection.style.display = 'none';
                            }
                        }
                        function toggleLike(discussionId) {
                            // Send AJAX request to like/unlike the discussion
                            $.ajax({
                                url: '/toggle-like/' + discussionId + '/',
                                method: 'POST',
                                data: {
                                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                                },
                                success: function(response) {
                                    if (response.status === 'success') {
                                        // Update the like icon and count
                                        var likeIcon = document.getElementById('like-icon-' + discussionId);
                                        var likeCount = document.getElementById('like-count-' + discussionId);
                                        likeIcon.classList.toggle('liked');
                                        likeCount.innerText = response.like_count + ' Like';
                                    } else {
                                        alert('Failed to like discussion: ' + response.message);
                                    }
                                },
                                error: function(xhr, status, error) {
                                    console.error('Error toggling like:', error);
                                }
                            });
                        }   
                    </script>
                </div>
            {% endfor %}
        {% endif %}
    </div>
    
<!-- Share Modal -->
<div id="share-modal" class="modal">
    <div class="modal-content">
        <!-- Share Button -->
      <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" target="_blank" class="btn-share">
        <i class="fab fa-facebook-f"></i>Facebook
    </a>
    <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ product.product_name }}" target="_blank" class="btn-share">
        <i class="fab fa-twitter"></i>Twitter
    </a>
    <a href="mailto:?subject={{ product.product_name }}&body=Check out this product: {{ request.build_absolute_uri }}" class="btn-share">
        <i class="fas fa-envelope"></i>Mail
    </a>
    <a href="https://www.instagram.com/?url={{ request.build_absolute_uri }}" target="_blank" class="btn-share">
        <i class="fab fa-instagram"></i>Instagram
    </a>
    </div>
</div>
    

<div id="transformation-container" class="container">
    <h3 style="text-align: center;">Transformations</h3>
    <div class="transformations-content">
        {% if transformations %}
            {% for transformation in transformations %}
                <div class="transformation" id="transformation-{{ transformation.id }}">
                    {% if transformation.image %}
                        <img src="{{ transformation.image.url }}" alt="Transformation Image">
                    {% endif %}
                    <p>{{ transformation.content }}</p>
                    <p>Posted by: {{ transformation.user.username }}</p>
                    <hr>
                    <div class="actions">
                        <div class="like-section">
                            <span class="action" onclick="toggleTransformationLike('{{ transformation.id }}')">
                                <img src="{% static 'images/like.jpg.jpg' %}" alt="Like" id="like-icon-{{ transformation.id }}" class="{% if request.user in transformation.likes.all %} liked {% endif %}">
                                <span id="like-count-{{ transformation.id }}">{{ transformation.likes }}</span> Like
                            </span>
                        </div>
                        <span class="action" onclick="toggleTransformationCommentSection('{{ transformation.id }}')"><img src="{% static 'images/comment.jpg.jpg' %}" alt="Comment"> Comment</span>
                        <span class="action" onclick="showShareModal('{{ transformation.id }}')"><img src="{% static 'images/share.jpg.jpg' %}" alt="Share"> Share</span>
                    </div>
                    <div id="comment-section-{{ transformation.id }}" class="comment-section" style="display: none;">
                        <input type="text" id="comment-input-{{ transformation.id }}" class="comment-input" placeholder="Write a comment">
                        <button onclick="postTransformationComment('{{ transformation.id }}')" class="comment-button">Post Comment</button>
                        <div id="comment-list-{{ transformation.id }}"></div>
                    </div>
                    <hr>
                </div>
            {% endfor %}
        {% endif %}
    </div>
</div>


    
    <div class="container" id="recipe-container">
        <h3 style="text-align: center;">Recipes</h3>
        <div class="recipes-content">
            {% if recipes %}
                {% for recipe in recipes %}
                    <div class="recipe" id="recipe-{{ recipe.id }}">
                        <h4>{{ recipe.name }}</h4>
                        <p>{{ recipe.story }}</p>
                        <p>Food Type: {{ recipe.food_type }}</p>
                        <p>Cuisine Type: {{ recipe.cuisine_type }}</p>
                        <p>Cooking Time: {{ recipe.cooking_time }}</p>
                        <p>Ingredients: {{ recipe.ingredients }}</p>
                        <p>Directions: {{ recipe.directions }}</p>
                        {% if recipe.image %}
                            <img src="{{ recipe.image.url }}" alt="Recipe Image">
                        {% endif %}
                        <p>Posted by: {{ recipe.user.username }}</p>
                        <hr>
                        <div class="actions">
                            <div class="like-section">
                                <span class="action" onclick="likeRecipe('{{ recipe.id }}')">
                                    <img src="{% static 'images/like.jpg.jpg' %}" alt="Like" id="like-icon-{{ recipe.id }}">
                                    <span id="like-count-{{ recipe.id }}">{{ recipe.likes }}</span> Like
                                </span>
                            </div>
                            <span class="action" onclick="showRecipeCommentSection('{{ recipe.id }}')"><img src="{% static 'images/comment.jpg.jpg' %}" alt="Comment"> Comment</span>
                            <span class="action" onclick="showRecipeShareModal('{{ recipe.id }}')"><img src="{% static 'images/share.jpg.jpg' %}" alt="Share"> Share</span>
                        </div>
                        <div id="recipe-comment-section-{{ recipe.id }}" class="comment-section" style="display: none;">
                            <input type="text" id="recipe-comment-input-{{ recipe.id }}" class="comment-input" placeholder="Write a comment">
                            <button onclick="postRecipeComment('{{ recipe.id }}')" class="comment-button">Post Comment</button>
                            <div id="recipe-comment-list-{{ recipe.id }}"></div>
                        </div>
                        <hr>
                    </div>
                {% endfor %}
            {% endif %}
        </div>
    </div>
    

    <!-- Modals for different post types -->
    <div id="discussionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('discussion')">&times;</span>
            <h2>Start a Discussion</h2>
            <form id="discussionForm" method="POST" action="/userhome/community/" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="text" id="discussionTitle" name="title" placeholder="Title" maxlength="255"><br><br>
                <div class="media-upload">
                    <label for="fileInput">
                        <img src="{% static 'images/addimage.jpg' %}" alt="Choose File" width="50" height="50" style="cursor: pointer;">
                        <span id="addPhotosVideos">Add photos/videos</span>
                    </label>
                    <input type="file" id="fileInput" name="image" accept="image/*, video/*" onchange="displaySelectedFile(this, 'previewImage', 'addPhotosVideos')" multiple style="display: none;">
                    <br>
                    <img id="previewImage" src="#" alt="Selected Image" width="100" height="100" style="display: none;">
                </div>
                <br>
                <br>

                <textarea id="discussionContent" name="content" rows="4" cols="50" placeholder="Start a discussion with the community!" maxlength="1000"></textarea><br>
               
                <div class="button-group">
                    <button type="button" onclick="closeModal('discussion')" class="cancel-btn">Cancel</button>
                    <button type="submit" class="post-btn">Post</button>
                </div>
            </form>
     
        </div>
    </div>
    
    
    <div id="fitnessUpdateModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('fitnessUpdate')">&times;</span>
            <h2>Post Update</h2>
            <form id="fitnessUpdateForm" method="POST" action="/userhome/post_fitness_update/" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="media-upload">
                    <label for="fileInputFitnessUpdate">
                        <img src="{% static 'images/addimage.jpg' %}" alt="Choose File" width="50" height="50" style="cursor: pointer;">
                        <span id="addPhotosVideosFitnessUpdate">Add photos/videos</span>
                    </label>
                    <input type="file" id="fileInputFitnessUpdate" name="fileInputFitnessUpdate" accept="image/*, video/*" onchange="displaySelectedFile(this, 'previewImageFitnessUpdate', 'addPhotosVideosFitnessUpdate')" multiple style="display: none;">
                    <br>
                    <img id="previewImageFitnessUpdate" src="#" alt="Selected Image" width="100" height="100" style="display: none;">
                </div>


                <textarea id="fitnessUpdateContent" name="fitnessUpdateContent" rows="4" cols="50" placeholder="Share fitness updates and tag others!" maxlength="1000"></textarea><br>
               
                <br>
                <br>
                <div class="button-group">
                    <button type="button" onclick="closeModal('fitnessUpdate')" class="cancel-btn">Cancel</button>
                    <button type="submit" class="post-btn">Post</button>
                </div>
            </form>
        </div>
    </div>
    
    
<!-- Transformation Modal -->
<div id="transformationModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('transformation')">&times;</span>
        <h2>Post Your Transformation</h2>
        <!-- Validation Messages -->
        <div id="transformationValidationMessages"></div>
        <form id="transformationForm" method="POST" action="{% url 'post_transformation' %}" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
                <label for="fileInputTransformation"></label>
                <div class="media-upload">
                    <input type="file" id="fileInputTransformation" name="fileInputTransformation" accept="image/*, video/*" onchange="displaySelectedFile(this, 'previewImageTransformation', 'addPhotosVideosTransformation')" multiple style="display: none;">
                    <label for="fileInputTransformation" class="file-input-label">
                        <img src="{% static 'images/addimage.jpg' %}" alt="Choose File" width="50" height="50" style="cursor: pointer;">
                        <span id="addPhotosVideosTransformation">Add photos/videos</span>
                    </label>
                </div>
                <img id="previewImageTransformation" src="#" alt="Selected Image" width="100" height="100" style="display: none;">
            </div>
            
            <div class="form-group">
                <label for="transformationContent">Transformation Description:</label>
                <textarea id="transformationContent" name="transformationContent" rows="4" placeholder="Share your transformation and inspire others!" maxlength="1000"></textarea>
            </div>
            
            <div class="button-group">
                <button type="button" onclick="closeModal('transformation')" class="cancel-btn">Cancel</button>
                <button type="submit" class="post-btn">Post</button>
            </div>
        </form>
    </div>
</div>


    <div id="recipeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('recipe')">&times;</span>
            <h2>Post Your Recipe</h2>
            <form id="recipeForm" method="POST" action="{% url 'post_recipe' %}" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="media-upload">
                    <label for="fileInputRecipe">
                        <img src="{% static 'images/addimage.jpg' %}" alt="Choose File" width="50" height="50" style="cursor: pointer;">
                        <span id="addPhotosVideosRecipe">Add photos/videos</span>
                    </label>
                    <input type="file" id="fileInputRecipe" name="fileInputRecipe" accept="image/*, video/*" onchange="displaySelectedFile(this, 'previewImageRecipe', 'addPhotosVideosRecipe')" multiple style="display: none;">
                    <br>
                    <img id="previewImageRecipe" src="#" alt="Selected Image" width="100" height="100" style="display: none;">
                </div>
                <br>
                <input type="text" id="recipeName" name="recipeName" placeholder="Enter the name of your recipe" style="width: 90%; padding: 8px; margin-bottom: 10px;"><br>
                <label for="recipeStory">Does it have a story?</label><br>
                <textarea id="recipeStory" name="recipeStory" rows="5" cols="50" placeholder="Share the story behind your recipe" style="width: 90%; padding: 8px; margin-bottom: 10px;"></textarea><br>
               
                <select id="foodType" name="foodType" style="width: 90%; padding: 8px; margin-bottom: 10px;">
                    <option value="Selectfoodtype">Select food type</option>
                    <option value="vegetarian">Vegetarian</option>
                    <option value="non-vegetarian">Non-Vegetarian</option>
                    <option value="eggetarian">Eggetarian</option>
                    <option value="vegan">Vegan</option>
                </select><br>
            
                <select id="cuisineType" name="cuisineType" style="width: 90%; padding: 8px; margin-bottom: 10px;">
                    <option value="Selectcuisinetype">Select cuisine type</option>
                    <option value="others">Others</option>
                    <option value="indian">Indian</option>
                    <option value="chinese">Chinese</option>
                    <option value="north-indian">North Indian</option>
                    <option value="south-indian">South Indian</option>
                    <option value="american">American</option>
                </select><br>
                <br>
                <input type="text" id="cookingTime" name="cookingTime" placeholder="Cooking time" style="width: 90%; padding: 8px; margin-bottom: 10px;"><br>
                <label for="ingredients">Ingredients:</label><br>
                <textarea id="ingredients" name="ingredients" rows="4" cols="50" placeholder="List the ingredients" style="width: 90%; padding: 8px; margin-bottom: 10px;"></textarea><br>
                <label for="directions">Directions:</label><br>
                <textarea id="directions" name="directions" rows="4" cols="50" placeholder="Provide cooking directions" style="width: 90%; padding: 8px; margin-bottom: 10px;"></textarea><br>
                <div class="button-group" style="text-align: right;">
                    <button type="button" onclick="closeModal('recipe')" class="cancel-btn" style="background-color: #ccc; color: #000; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">Cancel</button>
                    <button type="submit" class="post-btn" style="background-color: #6f42c1; color: #fff; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">Post</button>
                </div>
            </form>
        </div>
    </div>
    
</div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'js/global-functions.js' %}"></script>

<script>
    function showModal(type) {
        var modal = document.getElementById(type + 'Modal');
        modal.style.display = "block";
    }

    function closeModal(type) {
        var modal = document.getElementById(type + 'Modal');
        modal.style.display = "none";
    }

    window.onclick = function(event) {
        var modals = document.getElementsByClassName('modal');
        for (var i = 0; i < modals.length; i++) {
            if (event.target == modals[i]) {
                modals[i].style.display = "none";
            }
        }
    }

    function displaySelectedFile(input, imgTagId, addPhotosVideosId) {
        var file = input.files[0];
        var reader = new FileReader();
        reader.onload = function(e) {
            var img = document.getElementById(imgTagId);
            img.src = e.target.result;
            img.style.display = "block"; // Display the selected image
        }
        reader.readAsDataURL(file);

        // Hide the "Add photos/videos" span and the placeholder image
        var addPhotosVideos = document.getElementById(addPhotosVideosId);
        addPhotosVideos.style.display = "none";

        var addImage = document.querySelector('label[for="' + input.id + '"] img');
        addImage.style.display = "none";
        input.style.display = "none";
    }
    // Function to submit discussion form using AJAX
    function postDiscussion() {
        // Prevent default form submission
        event.preventDefault();

        // Collect data from the form fields
        var content = document.getElementById('discussionContent').value;
        var image = document.getElementById('fileInput').files[0];
        // Other form field values can be collected similarly

        // Create a FormData object
        var formData = new FormData();
        formData.append('content', content);
        formData.append('image', image);
        // Append other form field values to the FormData object

        // Send the form data to the server using AJAX
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/post_discussion/'); // Replace with your server endpoint
        xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken')); // Set CSRF token
        xhr.onload = function() {
            if (xhr.status === 200) {
                alert('Post added successfully.'); // Display success message
                closeModal('discussion'); // Close the modal after successful submission
            } else {
                alert('Error adding post.'); // Display error message
            }
        };
        xhr.send(formData);
    }
    function showAll() {
        var discussionContainer = document.getElementById('discussion-container');
        var transformationContainer = document.getElementById('transformation-container');
        var recipeContainer = document.getElementById('recipe-container');
    
        // Display all containers
        discussionContainer.style.display = 'block';
        transformationContainer.style.display = 'block';
        recipeContainer.style.display = 'block';

        fetchDiscussions();
        fetchTransformations();
        fetchRecipes();
    }
    function showDiscussions() {
        var discussionContainer = document.getElementById('discussion-container');
        var transformationContainer = document.getElementById('transformation-container');
        var recipeContainer = document.getElementById('recipe-container');
    
        // Display discussion container
        discussionContainer.style.display = 'block';
        transformationContainer.style.display = 'none'; // Hide transformation container
        recipeContainer.style.display = 'none'; // Hide recipe container
    
        // Fetch and display discussion posts
        fetchDiscussions();
    }
    
    // Function to fetch and display transformations dynamically
    function showTransformations() {
    var discussionContainer = document.getElementById('discussion-container');
    var transformationContainer = document.getElementById('transformation-container');
    var recipeContainer = document.getElementById('recipe-container');

    // Display transformation container
    discussionContainer.style.display = 'none'; // Hide discussion container
    transformationContainer.style.display = 'block';
    recipeContainer.style.display = 'none'; // Hide recipe container

        // Fetch and display transformation posts
    fetchTransformations();
    }

    function fetchTransformations() {
        fetch('/fetch-transformations/')
            .then(response => response.json())
            .then(data => {
                var transformationHTML = '';
                data.forEach(transformation => {
                    transformationHTML += `
                        <div class="transformation" id="transformation-${transformation.id}">
                            ${transformation.image ? `<img src="${transformation.image}" alt="Transformation Image" style="max-width: 100%;">` : ''}
                            <p>${transformation.content}</p>
                            <p>Posted by: ${transformation.user}</p>
                            <hr>
                            <div class="actions">
                                <div class="like-section">
                                    <span class="action" onclick="toggleTransformationLike('${transformation.id}')">
                                        <img src="{% static 'images/like.jpg.jpg' %}" alt="Like" id="like-icon-${transformation.id}">
                                        <span id="like-count-${transformation.id}">${transformation.likes}</span> Like
                                    </span>
                                </div>
                                <span class="action" onclick="showTransformationShareModal('${transformation.id}')"><img src="{% static 'images/share.jpg.jpg' %}" alt="Share"> Share</span>
                            </div>
                            <div class="comment-section">
                                <input type="text" id="comment-input-${transformation.id}" class="comment-input" placeholder="Write a comment">
                                <button onclick="postTransformationComment('${transformation.id}')" class="comment-button">Post Comment</button>
                                <div id="comment-list-${transformation.id}"></div>
                            </div>
                            <hr>
                        </div>
                    `;
                });
                // Update the content of the transformations-content div
                document.querySelector('.transformations-content').innerHTML = transformationHTML;
            })
            .catch(error => console.error('Error fetching transformations:', error));
    }
    

    function fetchRecipes() {
        fetch('/fetch_recipe/')
            .then(response => response.json())
            .then(data => {
                // Update HTML content with fetched recipe details
                var recipeHTML = '';
                data.forEach(recipe => {
                    recipeHTML += `
                        <div class="recipe" id="recipe-${recipe.id}">
                            <h4>${recipe.name}</h4>
                            <p>${recipe.story}</p>
                            <p>Food Type: ${recipe.food_type}</p>
                            <p>Cuisine Type: ${recipe.cuisine_type}</p>
                            <p>Cooking Time: ${recipe.cooking_time}</p>
                            <p>Ingredients: ${recipe.ingredients}</p>
                            <p>Directions: ${recipe.directions}</p>
                            ${recipe.image_url ? `<img src="${recipe.image_url}" alt="Recipe Image" style="max-width: 100%;">` : ''}
                            <p>Posted by: ${recipe.posted_by}</p>
                            <hr>
                            <div class="actions">
                                <div class="like-section">
                                    <span class="action" onclick="likeRecipe('${recipe.id}')">
                                        <img src="{% static 'images/like.jpg.jpg' %}" alt="Like" id="like-icon-${recipe.id}">
                                        <span id="like-count-${recipe.id}">${recipe.likes}</span> Like
                                    </span>
                                </div>
                                <span class="action" onclick="showRecipeCommentSection('${recipe.id}')"><img src="{% static 'images/comment.jpg.jpg' %}" alt="Comment"> Comment</span>
                                <span class="action" onclick="showRecipeShareModal('${recipe.id}')"><img src="{% static 'images/share.jpg.jpg' %}" alt="Share"> Share</span>
                            </div>
                            <div id="recipe-comment-section-${recipe.id}" class="comment-section" style="display: none;">
                                <input type="text" id="recipe-comment-input-${recipe.id}" class="comment-input" placeholder="Write a comment">
                                <button onclick="postRecipeComment('${recipe.id}')" class="comment-button">Post Comment</button>
                                <div id="recipe-comment-list-${recipe.id}"></div>
                            </div>
                            <hr>
                        </div>
                    `;
                });
                document.getElementById('recipe-container').innerHTML = recipeHTML;
            })
            .catch(error => console.error('Error fetching recipes:', error));
    }

        // Call fetchRecipes function when the page loads or when the user clicks on the recipes button
        window.onload = function() {
            fetchRecipes();
        };
        
        function showRecipes() {
            var discussionContainer = document.getElementById('discussion-container');
        var transformationContainer = document.getElementById('transformation-container');
        var recipeContainer = document.getElementById('recipe-container');

        // Display recipe container
        discussionContainer.style.display = 'none'; // Hide discussion container
        transformationContainer.style.display = 'none'; // Hide transformation container
        recipeContainer.style.display = 'block';

        // Fetch and display recipe posts
        fetchRecipes();
        }
        

        {% comment %} function showCommentModal(discussionId) {
            var commentSection = document.getElementById('comment-section-' + discussionId);
            commentSection.style.display = 'block';
        } {% endcomment %}

        function showShareModal(discussionId) {
            var shareModal = document.getElementById('share-modal');
            shareModal.style.display = 'block';
        }

        function showTransformationCommentSection(transformationId) {
            var commentSection = document.getElementById('comment-section-' + transformationId);
            if (commentSection.style.display === 'none') {
                commentSection.style.display = 'block';
            } else {
                commentSection.style.display = 'none';
            }
        }
        function postTransformationComment(transformationId) {
            var commentInput = document.getElementById('comment-input-' + transformationId);
            var content = commentInput.value.trim();
        
            if (content !== '') {
                $.ajax({
                    url: '/post-transformation-comment/' + transformationId + '/',
                    method: 'POST',
                    data: {
                        'content': content,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function(response) {
                        if (response.status === 'success') {
                            commentInput.value = '';
                            fetchTransformationComments(transformationId);
                        } else {
                            alert('Failed to post comment: ' + response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('Error posting transformation comment:', error);
                    }
                });
            } else {
                alert('Please enter a non-empty comment.');
            }
        }
        
        {% comment %} function showShareModal(transformationId) {
            var shareModal = document.getElementById('share-modal-' + transformationId);
            shareModal.style.display = 'block';
        }
         {% endcomment %}
        function fetchTransformationComments(transformationId) {
            $.ajax({
                url: '/fetch-transformation-comments/' + transformationId + '/',
                method: 'GET',
                success: function(response) {
                    var commentList = document.getElementById('comment-list-' + transformationId);
                    commentList.innerHTML = ''; // Clear existing comments
                    response.forEach(function(comment) {
                        var commentDiv = document.createElement('div');
                        commentDiv.innerText = comment.user + ': ' + comment.content;
                        commentList.appendChild(commentDiv);
                    });
                },
                error: function(xhr, status, error) {
                    console.error('Error fetching transformation comments:', error);
                }
            });
        }      
</script>
</body>
</html>