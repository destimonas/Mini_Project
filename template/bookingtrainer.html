<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Razorpay Library -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <!-- Add your custom CSS styling here -->
    <style>
        /* Custom Styling */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: #f8f9fa; /* Adjust as needed */
        }

        .header h1 {
            margin: 0;
            color: #d92cf9;
        }

        .back-button {
            margin-right: 10px;
        }

        .booking-container {
            margin-top: 20px;
        }

        .booking-details {
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .booking-details p {
            margin: 0;
        }
    </style>
</head>
<body>

<!-- Header -->
<div class="header">
    <h1>FitUp</h1>
    <a href="{% url 'userhome' %}" class="btn btn-secondary back-button">Back</a>
</div>

<!-- Container for Booking Details -->
<div class="container booking-container">
    <h2>My Booking Details</h2>
    <!-- Display Booking Details -->
    {% for booking in bookings %}
    <div class="booking-details">
        <p><strong>Package Name:</strong> {{ booking.package_name }}</p>
        <p><strong>Package Amount:</strong> {{ booking.package_amount }}</p>
        <p><strong>Discount:</strong> {{ booking.discount }}</p>
        <p><strong>Renewal Discount:</strong> {{ booking.renewal_discount }}</p>
        <p><strong>Selected Time Slots:</strong> {{ booking.selected_time_slots }}</p>
        
        {% if booking.is_accepted %}
            <p>This booking has been accepted.</p>
            {% if not booking.payment_set.all %}
                <button type="button" class="btn btn-primary" data-trainer-id="{{ booking.trainer.id }}" onclick="openRazorpayPaymentModal('{{ booking.package_amount }}')">Make Payment</button>
            {% else %}
                <!-- If payment exists, show the download receipt link -->
                <a href="{% url 'generate_pdf_receipt' booking_id=booking.id %}" class="btn btn-success">Download Receipt</a>
            {% endif %}
        {% elif booking.is_rejected %}
            <p>This booking has been rejected.</p>
        {% else %}
            <p>Pending</p>
        {% endif %}
        
    </div>
    
</div>

<!-- Razorpay Payment Modal (with dummy content) -->
<div class="modal fade" id="razorpayPaymentModal" tabindex="-1" aria-labelledby="razorpayPaymentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="razorpayPaymentModalLabel">Payment Gateway</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h4>Payment Details</h4>
                <p><strong>Package Amount:</strong> <span id="packageAmount"></span></p>
                <p><strong>Payment Method:</strong> <span id="paymentMethod"></span></p>
                
                <!-- Razorpay payment form -->
                <form id="razorpay-form">
                    <script src="https://checkout.razorpay.com/v1/checkout.js"
                        data-key="{{ razorpay_key }}"
                        data-amount=""  
                        data-name="Fitness Tracker"
                        data-description="Payment for Trainer Services"
                        data-image="https://your-logo-url.com/your-logo.png"
                        data-prefill.name="{{ payment_id.customer_name }}"
                        data-prefill.email="{{ payment_id.customer_email }}"
                        data-prefill.contact="{{ payment_id.customer_contact }}"
                        data-theme.color="#6a0dad"></script>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap and jQuery Scripts -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Function to open Razorpay payment modal
function openRazorpayPaymentModal(amount) {
    var options = {
        key: 'rzp_test_v4Tz9K1hhXrTYr', // Replace with your Razorpay key
        amount: amount * 100, // Convert amount to paise (assuming amount is in rupees)
        currency: "INR",
        name: 'Fitness Tracker',
        description: 'Payment for Trainer Services',
        image: 'https://your-logo-url.com/your-logo.png',
        prefill: {
            name: 'Customer Name',
            email: 'customer@example.com',
            contact: '1234567890',
        },
        theme: {
            color: '#6a0dad',
        },
        handler: function(response) {
            alert("Payment Successfull.");
            window.location.href ='{% url "success" booking_id=booking.id %}';           

            // Handle success scenario here
        },
        modal: {
            ondismiss: function() {
                // Handle modal close event here
            }
        }
    };

    var rzp = new Razorpay(options);
    rzp.open();
}
</script>
{% endfor %}
</body>
</html>
